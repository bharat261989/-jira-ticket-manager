# Jira Ticket Manager Configuration (HOCON)
# Local overrides should be placed in user.conf

jira {
  # Jira Server URL
  baseUrl = "http://localhost:8080"
  baseUrl = ${?JIRA_BASE_URL}

  # Primary project key - used by all tasks as default
  baseProject = "PROJ"
  baseProject = ${?JIRA_BASE_PROJECT}

  # Credentials
  username = "admin"
  username = ${?JIRA_USERNAME}

  apiToken = "changeme"
  apiToken = ${?JIRA_API_TOKEN}

  # Connection settings (milliseconds)
  connectionTimeout = 5000
  connectionTimeout = ${?JIRA_CONNECTION_TIMEOUT}

  readTimeout = 30000
  readTimeout = ${?JIRA_READ_TIMEOUT}

  socketTimeout = 30000
  socketTimeout = ${?JIRA_SOCKET_TIMEOUT}

  maxConnections = 20
  maxConnections = ${?JIRA_MAX_CONNECTIONS}

  # Startup validation settings
  # Set to true to validate Jira connectivity on startup
  validateOnStartup = false
  validateOnStartup = ${?VALIDATE_ON_STARTUP}

  # Sample issue number to check (e.g., 123 checks PROJECT-123)
  sampleIssueNumber = 123
  sampleIssueNumber = ${?SAMPLE_ISSUE_NUMBER}
}

# Background tasks configuration
tasks {
  schedulerPoolSize = 4
  onDemandPoolSize = 2

  # Issue Sync Task - syncs issues from Jira based on JQL
  issueSync {
    enabled = true
    intervalMinutes = 30
    initialDelayMinutes = 1
    # Uses jira.baseProject by default, can be overridden
    jqlFilter = "project = "${jira.baseProject}" AND updated >= -1d"
    batchSize = 100
  }

  # Stale Issue Cleanup Task
  staleIssueCleanup {
    enabled = false
    intervalMinutes = 1440
    initialDelayMinutes = 60
    staleDays = 30
    targetStatus = "Closed"
    dryRun = true
  }
}

# Dropwizard server configuration
server {
  applicationConnectors = [
    {
      type = http
      port = 8081
    }
  ]
  adminConnectors = [
    {
      type = http
      port = 8082
    }
  ]
}

# Logging configuration
logging {
  level = INFO
  loggers {
    "org.limits" = DEBUG
    "org.limits.task" = INFO
    "com.atlassian.jira" = INFO
  }
  appenders = [
    {
      type = console
      threshold = ALL
      target = stdout
    }
  ]
}

# Include user.conf for local overrides (if exists)
include "user.conf"
