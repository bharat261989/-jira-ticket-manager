# Jira Ticket Manager Configuration (HOCON)
# Local overrides go in user.conf (gitignored)

jira {
  # Jira Server URL
  baseUrl = "http://localhost:8080"
  baseUrl = ${?JIRA_BASE_URL}

  # Primary project key - used by all tasks as default
  baseProject = "PROJ"
  baseProject = ${?JIRA_BASE_PROJECT}

  # Credentials
  username = "admin"
  username = ${?JIRA_USERNAME}

  apiToken = "changeme"
  apiToken = ${?JIRA_API_TOKEN}

  # Connection settings (milliseconds)
  connectionTimeout = 5000
  connectionTimeout = ${?JIRA_CONNECTION_TIMEOUT}

  readTimeout = 30000
  readTimeout = ${?JIRA_READ_TIMEOUT}

  socketTimeout = 30000
  socketTimeout = ${?JIRA_SOCKET_TIMEOUT}

  maxConnections = 20
  maxConnections = ${?JIRA_MAX_CONNECTIONS}

  # Startup validation settings
  validateOnStartup = false
  validateOnStartup = ${?VALIDATE_ON_STARTUP}

  sampleIssueNumber = 123
  sampleIssueNumber = ${?SAMPLE_ISSUE_NUMBER}
}

# Background tasks configuration
tasks {
  schedulerPoolSize = 4
  onDemandPoolSize = 2

  issueSync {
    enabled = true
    intervalMinutes = 30
    initialDelayMinutes = 1
    jqlFilter = "project = "${jira.baseProject}" AND updated >= -1d"
    batchSize = 100
  }

  staleIssueCleanup {
    enabled = false
    intervalMinutes = 1440
    initialDelayMinutes = 60
    staleDays = 30
    targetStatus = "Closed"
    dryRun = true
  }
}

# Dropwizard server configuration
server {
  applicationConnectors = [
    {
      type = http
      port = 8081
      port = ${?SERVER_PORT}
    }
  ]
  adminConnectors = [
    {
      type = http
      port = 8082
      port = ${?ADMIN_PORT}
    }
  ]
}

# Logging configuration
logging {
  level = INFO
  level = ${?LOG_LEVEL}

  loggers {
    "org.limits" = DEBUG
    "org.limits.task" = INFO
    "com.atlassian.jira" = INFO
  }

  appenders = [
    {
      type = console
      threshold = ALL
      target = stdout
    }
  ]
}
